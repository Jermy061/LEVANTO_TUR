// ----------------------------------------------------------------------------------
// PROYECTO: LEVANTO CONECTA (Fusión: Turismo Regional + Negocio Multi-Tenant)
// BASE DE DATOS: MariaDB / MySQL
// ----------------------------------------------------------------------------------

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ==================================================================================
//                              I. ENUMERACIONES
// ==================================================================================

// --- ENUMS DE AUTENTICACIÓN Y NEGOCIO DE TURISMO ---
enum UserRole {
  ADMIN
  TENANT_OWNER
}

enum BusinessType {
  ACCOMMODATION
  RESTAURANT
  TRANSPORT
  LOCAL_PRODUCT
  TOUR_AGENCY
}

// --- ENUMS EXISTENTES DE TU SISTEMA POS/INVENTARIO ---
enum TipoCategoria {
  COMIDA
  BEBIDA
}

enum mesas_estado {
  Libre
  Ocupada
  Reservada
}

enum ordenes_estado {
  Abierta
  Cerrada
  Pagada
  Cancelada
}

enum pagos_metodo_pago {
  Efectivo
  Tarjeta
  Transferencia
  Otro
}

enum reservas_estado {
  Pendiente
  Confirmada
  Cancelada
  Completada
}

enum webpedidos_tipo {
  RecogerEnTienda
  EntregaDomicilio
}

enum webpedidos_estado {
  Pendiente
  Confirmado
  EnPreparacion
  ListoParaRecoger
  EnCamino
  Entregado
  Cancelado
}

enum cajas_estado {
  Abierta
  Cerrada
}

enum cajas_tipo_mov {
  INGRESO
  EGRESO
}


// ==================================================================================
//                        II. MODELOS CENTRALES (AUTH & TENANCY)
// ==================================================================================

// 1. User: Autenticación central de la plataforma (ADMIN y Dueños)
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique @db.VarChar(255)
  password  String   @db.VarChar(255)
  name      String   @db.VarChar(255)
  role      UserRole @default(TENANT_OWNER)
  createdAt DateTime @default(now()) @db.Timestamp(0)
  updatedAt DateTime @updatedAt @db.DateTime(0)

  tenantId  Int?
  tenant    tenants? @relation(fields: [tenantId], references: [id])
}

// 2. tenants: El Inquilino Maestro (Combinado Turismo + POS/Inventario)
model tenants {
  id               Int            @id @default(autoincrement())
  nombre_empresa   String         @db.VarChar(255)
  subdominio       String         @unique(map: "subdominio") @db.VarChar(100)
  isActive         Boolean?       @default(false)
  configuracion    String?        @db.LongText
  created_at       DateTime       @default(now()) @db.Timestamp(0)

  // --- CAMPOS DE TURISMO (FASE 1) ---
  businessType     BusinessType?
  slogan           String?        @db.VarChar(255)
  description_public String?      @db.Text
  mainImageUrl     String?        @db.VarChar(2048)
  contactPhone     String?        @db.VarChar(50)
  email_public     String?        @db.VarChar(255)
  latitude         Float?
  longitude        Float?
  isApproved       Boolean        @default(false)
  isPublished      Boolean        @default(false)

  // --- RELACIONES DE TURISMO (Nuevas) ---
  owner           User[]
  accommodations  Accommodation[]
  restaurants     Restaurant[]
  transport       TransportationCompany[]
  localProducts   LocalProduct[]

  // --- RELACIONES DE POS/INVENTARIO (Existentes) ---
  categoriasmenu  categoriasmenu[]
  clientes clientes[]
  empleados empleados[]
  descuentos_empleados descuentos_empleados[]
  tenant_eventos    eventos[]       @relation(name: "TenantEvents") 
  tenant_galeria    galeriafotos[]  @relation(name: "TenantGallery")
  mesas mesas[]
  ordendetalles ordendetalles[]
  ordenes ordenes[]
  pagos pagos[]
  productos productos[]
  proveedores proveedores[]
  reservas reservas[]
  webpedidos webpedidos[]
  webpedidos_detalles webpedidos_detalles[]
  tenant_config_pedidos tenant_config_pedidos?
  categorias_inventario categorias_inventario[]
  tipos_gasto tipos_gasto[]
  unidades_medida unidades_medida[]
  productos_inventario productos_inventario[]
  compras compras[]
  compras_detalles compras_detalles[]
  gastos gastos[]
  conteos_fisicos conteos_fisicos[]
  conteos_detalles conteos_detalles[]
  cierres_inventario cierres_inventario[]
  kardex kardex[]
  cajas cajas[]
  cajas_movimientos cajas_movimientos[]
}


// ==================================================================================
//                      III. MODELOS DE TURISMO (GESTIÓN MUNICIPAL)
// ==================================================================================

// Contenido Turístico Fijo (Gestionado por la Municipalidad)
model TouristicPlace {
  id          Int      @id @default(autoincrement())
  name        String   @unique @db.VarChar(255)
  description String   @db.Text
  history     String?  @db.LongText
  mainImageUrl String @db.VarChar(2048)
  latitude    Float?
  longitude   Float?

  @@map("touristic_places")
}

// Hoteles/Hospedajes (Relacionado a Tenant)
model Accommodation {
  id          Int      @id @default(autoincrement())
  tenant_id   Int
  title       String   @db.VarChar(255)
  description String?  @db.Text
  pricePerNight Decimal? @db.Decimal(10, 2)
  imageUrl    String   @db.VarChar(2048)
  isPublished Boolean  @default(false)

  tenants     tenants  @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([tenant_id])
  @@map("accommodations")
}

// Restaurantes (Relacionado a Tenant)
model Restaurant {
  id          Int      @id @default(autoincrement())
  tenant_id   Int
  title       String   @db.VarChar(255)
  specialty   String?  @db.VarChar(255)
  averagePriceRange String? @db.VarChar(20)
  isPublished Boolean  @default(false)

  tenants     tenants  @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([tenant_id])
  @@map("restaurants")
}

// Transporte (Relacionado a Tenant)
model TransportationCompany {
  id          Int      @id @default(autoincrement())
  tenant_id   Int
  serviceName String   @db.VarChar(255)
  route       String   @db.VarChar(255)
  fare        Decimal? @db.Decimal(10, 2)
  vehicleType String?  @db.VarChar(50)
  isPublished Boolean  @default(false)

  tenants     tenants  @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([tenant_id])
  @@map("transportation_companies")
}

// Productos Locales (Relacionado a Tenant)
model LocalProduct {
  id          Int      @id @default(autoincrement())
  tenant_id   Int
  name        String   @db.VarChar(255)
  productType String?  @db.VarChar(100)
  description String?  @db.Text
  price       Decimal? @db.Decimal(10, 2)
  imageUrl    String   @db.VarChar(2048)
  isPublished Boolean  @default(false)

  tenants     tenants  @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([tenant_id])
  @@map("local_products")
}


// ==================================================================================
//                         IV. MODELOS DE POS/INVENTARIO (EXISTENTES)
// ==================================================================================

// --- Modelos de Inventario y Compras ---
model categorias_inventario {
  id          Int      @id @default(autoincrement())
  tenant_id   Int
  nombre      String   @db.VarChar(100)
  descripcion String?  @db.Text
  color       String?  @db.VarChar(7)
  icono       String?  @db.VarChar(50)
  orden       Int?     @default(0)
  activa      Boolean  @default(true)
  created_at  DateTime @default(now()) @db.Timestamp(0)

  tenants              tenants              @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  productos_inventario productos_inventario[]

  @@unique([tenant_id, nombre], map: "tenant_categoria_inventario")
  @@index([tenant_id])
  @@index([activa], map: "activa_idx")
}

model tipos_gasto {
  id                Int      @id @default(autoincrement())
  tenant_id         Int
  nombre            String   @db.VarChar(100)
  descripcion       String?  @db.Text
  afecta_inventario Boolean  @default(false)
  color             String?  @db.VarChar(7)
  icono             String?  @db.VarChar(50)
  orden             Int?     @default(0)
  activo            Boolean  @default(true)
  created_at        DateTime @default(now()) @db.Timestamp(0)

  tenants tenants @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  gastos  gastos[]
  compras compras[]

  @@unique([tenant_id, nombre])
  @@index([tenant_id])
  @@index([activo])
  @@map("tipos_gasto")
}

model unidades_medida {
  id          Int      @id @default(autoincrement())
  tenant_id   Int
  nombre      String   @db.VarChar(50)
  abreviatura String   @db.VarChar(10)
  tipo        String?  @db.VarChar(50)
  activa      Boolean  @default(true)
  created_at  DateTime @default(now()) @db.Timestamp(0)

  tenants              tenants              @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  productos_inventario productos_inventario[]

  @@unique([tenant_id, nombre], map: "tenant_unidad_medida")
  @@index([tenant_id])
}

model productos_inventario {
  id                    Int      @id @default(autoincrement())
  tenant_id             Int
  categoria_inventario_id Int?
  unidad_medida_id      Int?
  nombre                String   @db.VarChar(255)
  codigo_barras         String?  @db.VarChar(50)
  stock_actual          Decimal? @default(0.000) @db.Decimal(10, 3)
  costo_unitario        Decimal? @default(0.00) @db.Decimal(10, 2)
  stock_minimo          Decimal? @default(0.000) @db.Decimal(10, 3)
  stock_maximo          Decimal? @db.Decimal(10, 3)
  ultimo_conteo         DateTime? @db.Timestamp(0)
  stock_anterior        Decimal? @default(0.000) @db.Decimal(10, 3)
  activo                Boolean  @default(true)
  created_at            DateTime @default(now()) @db.Timestamp(0)

  tenants               tenants              @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: Restrict)
  categorias_inventario categorias_inventario? @relation(fields: [categoria_inventario_id], references: [id], onUpdate: Restrict)
  unidades_medida       unidades_medida?       @relation(fields: [unidad_medida_id], references: [id], onUpdate: Restrict)

  compras_detalles compras_detalles[]
  conteos_detalles conteos_detalles[]
  cierres_detalles cierres_inventario_detalles[]
  kardex           kardex[]
  productos_menu   productos[]

  @@unique([tenant_id, nombre], map: "tenant_producto_inventario")
  @@index([tenant_id])
  @@index([categoria_inventario_id], map: "categoria_inventario_id")
  @@index([unidad_medida_id], map: "unidad_medida_id")
  @@index([activo], map: "activo_idx")
}

model compras {
  id             Int      @id @default(autoincrement())
  tenant_id      Int
  tipo_gasto_id  Int
  proveedor_id   Int?
  fecha          DateTime @db.DateTime(0)
  total          Decimal  @db.Decimal(10, 2)
  numero_documento String?  @db.VarChar(100)
  observaciones  String?  @db.Text
  estado_compra  String   @default("Pendiente") @db.VarChar(50)
  created_at     DateTime @default(now()) @db.Timestamp(0)

  tenants          tenants          @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  tipos_gasto      tipos_gasto      @relation(fields: [tipo_gasto_id], references: [id])
  proveedores      proveedores?     @relation(fields: [proveedor_id], references: [id])
  compras_detalles compras_detalles[]

  @@index([tenant_id])
  @@index([tipo_gasto_id])
  @@index([proveedor_id])
  @@index([estado_compra])
  @@map("compras")
}

model compras_detalles {
  id                     Int      @id @default(autoincrement())
  tenant_id              Int
  compra_id              Int
  producto_inventario_id Int
  cantidad               Decimal @db.Decimal(10, 3)
  costo_unitario         Decimal @db.Decimal(10, 2)

  tenants              tenants              @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  compras              compras              @relation(fields: [compra_id], references: [id], onDelete: Cascade)
  productos_inventario productos_inventario @relation(fields: [producto_inventario_id], references: [id])

  @@index([tenant_id])
  @@index([compra_id])
  @@index([producto_inventario_id])
  @@map("compras_detalles")
}

model gastos {
  id               Int      @id @default(autoincrement())
  tenant_id        Int
  tipo_gasto_id    Int
  proveedor_id     Int?
  fecha            DateTime @db.DateTime(0)
  monto            Decimal  @db.Decimal(10, 2)
  numero_documento String?  @db.VarChar(100)
  descripcion      String?  @db.Text
  metodo_pago      String?  @db.VarChar(50)
  aprobado_por_id  Int?

  tenants     tenants              @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  tipos_gasto tipos_gasto          @relation(fields: [tipo_gasto_id], references: [id])
  proveedores proveedores?         @relation(fields: [proveedor_id], references: [id])
  empleados   empleados?           @relation(fields: [aprobado_por_id], references: [id])
  descuentos_aplicados descuentos_empleados[]

  @@index([tenant_id])
  @@index([tipo_gasto_id])
  @@index([fecha])
  @@map("gastos")
}

model conteos_fisicos {
  id               Int      @id @default(autoincrement())
  tenant_id        Int
  fecha_conteo     DateTime @default(now()) @db.Timestamp(0)
  realizado_por    String?  @db.VarChar(255)
  notas            String?  @db.Text
  total_productos  Int?
  valor_total      Decimal? @db.Decimal(10, 2)
  diferencia_total Decimal? @db.Decimal(10, 2)

  tenants  tenants @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  detalles conteos_detalles[]

  @@index([tenant_id])
  @@index([fecha_conteo], map: "fecha_conteo_idx")
}

model conteos_detalles {
  id                     Int      @id @default(autoincrement())
  tenant_id              Int
  conteo_id              Int
  producto_inventario_id Int
  stock_sistema          Decimal @db.Decimal(10, 3)
  stock_fisico           Decimal @db.Decimal(10, 3)
  diferencia             Decimal @db.Decimal(10, 3)
  costo_unitario         Decimal @db.Decimal(10, 2)
  valor_diferencia       Decimal @db.Decimal(10, 2)
  observaciones          String? @db.Text

  tenants              tenants              @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  conteos_fisicos      conteos_fisicos      @relation(fields: [conteo_id], references: [id], onDelete: Cascade)
  productos_inventario productos_inventario @relation(fields: [producto_inventario_id], references: [id], onDelete: Restrict)

  @@index([tenant_id])
  @@index([conteo_id], map: "conteo_id")
  @@index([producto_inventario_id], map: "producto_inventario_id")
}

model proveedores {
  id              Int      @id @default(autoincrement())
  tenant_id       Int
  nombre_empresa  String   @db.VarChar(255)
  contacto_nombre String?  @db.VarChar(255)
  email           String?  @db.VarChar(255)
  telefono        String?  @db.VarChar(50)
  direccion       String?  @db.Text
  ruc             String?  @db.VarChar(20)
  activo          Boolean  @default(true)
  created_at      DateTime @default(now()) @db.Timestamp(0)

  compras compras[]
  gastos  gastos[]
  tenants tenants @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: Restrict)

  @@unique([tenant_id, nombre_empresa], map: "tenant_proveedor")
  @@index([tenant_id])
}

// --- Modelos de Menú, Órdenes y Web ---
model categoriasmenu {
  id             Int           @id @default(autoincrement())
  tenant_id      Int
  nombre         String        @db.VarChar(100)
  tipo           TipoCategoria @default(COMIDA)
  slug           String?       @db.VarChar(100)
  descripcion    String?       @db.Text
  orden          Int?          @default(0)
  visible_en_web Boolean?      @default(false)

  tenants   tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "categoriasmenu_ibfk_1")
  productos productos[]

  @@unique([tenant_id, slug], map: "tenant_slug")
  @@index([tenant_id])
}

model productos {
  id                     Int      @id @default(autoincrement())
  tenant_id              Int
  categoria_id           Int
  nombre                 String   @db.VarChar(255)
  descripcion            String?  @db.Text
  precio                 Decimal  @db.Decimal(10, 2)
  foto_url               String?  @db.VarChar(2048)
  disponible             Boolean? @default(true)
  visible_en_web         Boolean? @default(false)
  es_vegetariano         Boolean? @default(false)
  es_vegano              Boolean? @default(false)
  sin_gluten             Boolean? @default(false)
  es_picante             Boolean? @default(false)
  es_recomendado         Boolean? @default(false)
  es_nuevo               Boolean? @default(false)

  producto_inventario_id Int?

  ordendetalles       ordendetalles[]
  tenants             tenants               @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "productos_ibfk_1")
  categoriasmenu      categoriasmenu        @relation(fields: [categoria_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "productos_ibfk_2")
  webpedidos_detalles webpedidos_detalles[]
  producto_inventario productos_inventario? @relation(fields: [producto_inventario_id], references: [id])

  @@index([categoria_id], map: "categoria_id")
  @@index([tenant_id])
  @@index([es_recomendado], map: "es_recomendado")
  @@index([es_nuevo], map: "es_nuevo")
  @@index([producto_inventario_id])
}

model webpedidos {
  id                    Int             @id @default(autoincrement())
  tenant_id             Int
  cliente_id            Int?
  cliente_nombre        String          @db.VarChar(255)
  cliente_email         String?         @db.VarChar(255)
  cliente_telefono      String          @db.VarChar(50)
  tipo_pedido           webpedidos_tipo
  estado                webpedidos_estado @default(Pendiente)
  numero_pedido         String          @db.VarChar(50)
  subtotal              Decimal         @db.Decimal(10, 2)
  total                 Decimal         @db.Decimal(10, 2)
  costo_envio           Decimal         @default(0) @db.Decimal(10, 2)
  direccion_entrega     String?         @db.Text
  instrucciones_entrega String?         @db.Text
  hora_programada       DateTime?       @db.Timestamp(0)
  notas_especiales      String?         @db.Text
  notas                 String?         @db.Text
  created_at            DateTime        @default(now()) @db.Timestamp(0)
  updated_at            DateTime?       @db.Timestamp(0)

  tenants             tenants               @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  clientes            clientes?             @relation(fields: [cliente_id], references: [id], onUpdate: Restrict)
  webpedidos_detalles webpedidos_detalles[]
  ordenes             ordenes[]

  @@unique([tenant_id, numero_pedido], map: "tenant_numero_pedido")
  @@index([tenant_id])
  @@index([cliente_id], map: "cliente_id")
  @@index([estado], map: "estado")
  @@index([created_at], map: "created_at")
  @@index([hora_programada], map: "hora_programada")
}

model webpedidos_detalles {
  id              Int     @id @default(autoincrement())
  tenant_id       Int
  webpedido_id    Int
  producto_id     Int
  cantidad        Int
  precio_unitario Decimal @db.Decimal(10, 2)
  subtotal        Decimal @db.Decimal(10, 2)

  tenants    tenants    @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  webpedidos webpedidos @relation(fields: [webpedido_id], references: [id], onDelete: Cascade)
  productos  productos  @relation(fields: [producto_id], references: [id], onUpdate: Restrict)

  @@index([tenant_id])
  @@index([webpedido_id], map: "webpedido_id")
  @@index([producto_id], map: "producto_id")
}

model tenant_config_pedidos {
  id                        Int      @id @default(autoincrement())
  tenant_id                 Int      @unique
  dias_limite_reserva       Int      @default(2)
  notif_pedido_confirmado   Boolean  @default(true)
  notif_pedido_cancelado    Boolean  @default(true)
  notif_pedido_listo        Boolean  @default(true)
  email_asunto_confirmado   String?  @db.VarChar(255)
  email_asunto_cancelado    String?  @db.VarChar(255)
  email_asunto_listo        String?  @db.VarChar(255)
  costo_envio_estandar      Decimal  @default(0) @db.Decimal(10, 2)
  monto_minimo_pedido       Decimal  @default(0) @db.Decimal(10, 2)
  tiempo_preparacion_promedio Int @default(30)
  horario_apertura          String @default("08:00") @db.VarChar(50)
  horario_cierre            String @default("22:00") @db.VarChar(50)

  tenants tenants @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
}

model clientes {
  id         Int      @id @default(autoincrement())
  tenant_id  Int
  nombre     String   @db.VarChar(255)
  email      String?  @db.VarChar(255)
  telefono   String?  @db.VarChar(50)
  created_at DateTime @default(now()) @db.Timestamp(0)

  tenants    tenants    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "clientes_ibfk_1")
  reservas   reservas[]
  webpedidos webpedidos[]

  @@unique([tenant_id, email])
}

model empleados {
  id                  Int      @id @default(autoincrement())
  tenant_id           Int
  rol_id              Int
  email               String   @db.VarChar(255)
  password_hash       String?  @db.VarChar(255)
  nombre              String?  @db.VarChar(255)
  documento_identidad String?  @db.VarChar(50)
  telefono            String?  @db.VarChar(50)

  requiere_login      Boolean  @default(false)
  es_propietario      Boolean  @default(false)
  is_active           Boolean  @default(true)
  debe_cambiar_pass   Boolean  @default(true)

  salario             Decimal? @db.Decimal(10, 2)
  fecha_ingreso       DateTime? @db.Date

  created_at          DateTime @default(now())
  updatedAt DateTime @updatedAt @db.DateTime(0)

  tenants             tenants              @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "empleados_ibfk_1")
  roles               roles                @relation(fields: [rol_id], references: [id], onUpdate: Restrict, map: "empleados_ibfk_2")
  ordenes             ordenes[]
  pagos               pagos[]
  cierres_inventario  cierres_inventario[]
  gastos              gastos[]
  cajas_responsable   cajas[]
  movimientos_caja    cajas_movimientos[]
  kardex              kardex[]
  descuentos          descuentos_empleados[]

  @@unique([tenant_id, email])
  @@index([rol_id], map: "rol_id")
  @@index([tenant_id, requiere_login])
  @@index([tenant_id, es_propietario])
}

model descuentos_empleados {
  id          Int      @id @default(autoincrement())
  tenant_id   Int
  empleado_id Int
  monto       Decimal  @db.Decimal(10, 2)
  motivo      String   @db.VarChar(255)
  fecha       DateTime @default(now()) @db.Timestamp(0)

  estado      String   @default("Pendiente") @db.VarChar(50)

  gasto_id    Int?
  created_at  DateTime @default(now()) @db.Timestamp(0)

  tenants     tenants  @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  empleados   empleados @relation(fields: [empleado_id], references: [id], onDelete: Cascade)
  gastos      gastos?  @relation(fields: [gasto_id], references: [id])

  @@index([tenant_id])
  @@index([empleado_id])
  @@index([gasto_id])
}

model ordenes {
  id           Int           @id @default(autoincrement())
  tenant_id    Int
  mesa_id      Int
  empleado_id  Int
  estado       ordenes_estado? @default(Abierta)
  subtotal     Decimal?      @default(0.00) @db.Decimal(10, 2)
  descuento    Decimal?      @default(0.00) @db.Decimal(10, 2)
  total        Decimal?      @default(0.00) @db.Decimal(10, 2)
  created_at   DateTime      @default(now()) @db.Timestamp(0)
  closed_at    DateTime?     @db.Timestamp(0)
  webpedido_id Int?

  ordendetalles ordendetalles[]
  tenants       tenants       @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "ordenes_ibfk_1")
  mesas         mesas         @relation(fields: [mesa_id], references: [id], onUpdate: Restrict, map: "ordenes_ibfk_2")
  empleados     empleados     @relation(fields: [empleado_id], references: [id], onUpdate: Restrict, map: "ordenes_ibfk_3")
  pagos         pagos[]
  webpedidos    webpedidos?   @relation(fields: [webpedido_id], references: [id], onUpdate: Restrict, map: "ordenes_ibfk_4")

  @@index([empleado_id], map: "empleado_id")
  @@index([mesa_id], map: "mesa_id")
  @@index([tenant_id])
  @@index([webpedido_id], map: "webpedido_id")
}

model ordendetalles {
  id              Int     @id @default(autoincrement())
  tenant_id       Int
  orden_id        Int
  producto_id     Int
  cantidad        Int
  precio_unitario Decimal @db.Decimal(10, 2)
  notas           String? @db.Text

  tenants   tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: Restrict)
  ordenes   ordenes   @relation(fields: [orden_id], references: [id], onDelete: Cascade, onUpdate: Restrict)
  productos productos @relation(fields: [producto_id], references: [id], onUpdate: Restrict)

  @@index([orden_id], map: "orden_id")
  @@index([producto_id], map: "producto_id")
  @@index([tenant_id])
}

model pagos {
  id          Int                 @id @default(autoincrement())
  tenant_id   Int
  orden_id    Int
  empleado_id Int
  metodo_pago pagos_metodo_pago
  monto       Decimal             @db.Decimal(10, 2)
  created_at  DateTime            @default(now()) @db.Timestamp(0)

  tenants   tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "pagos_ibfk_1")
  ordenes   ordenes   @relation(fields: [orden_id], references: [id], onUpdate: Restrict, map: "pagos_ibfk_2")
  empleados empleados @relation(fields: [empleado_id], references: [id], onUpdate: Restrict, map: "pagos_ibfk_3")

  @@index([empleado_id], map: "empleado_id")
  @@index([orden_id], map: "orden_id")
  @@index([tenant_id])
}

model reservas {
  id              Int             @id @default(autoincrement())
  tenant_id       Int
  cliente_id      Int?
  mesa_id         Int?
  cliente_nombre  String          @db.VarChar(255)
  cliente_email   String?         @db.VarChar(255)
  cliente_telefono String         @db.VarChar(50)
  fecha_hora      DateTime        @db.DateTime(0)
  cantidad_personas Int
  estado          reservas_estado? @default(Pendiente)
  notas           String?         @db.Text
  created_at      DateTime        @default(now()) @db.Timestamp(0)

  tenants   tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "reservas_ibfk_1")
  clientes  clientes? @relation(fields: [cliente_id], references: [id], onUpdate: Restrict, map: "reservas_ibfk_2")
  mesas     mesas?    @relation(fields: [mesa_id], references: [id], onUpdate: Restrict, map: "reservas_ibfk_3")

  @@index([cliente_id], map: "cliente_id")
  @@index([mesa_id], map: "mesa_id")
  @@index([tenant_id])
}

model roles {
  id          Int        @id @default(autoincrement())
  nombre      String     @unique(map: "nombre") @db.VarChar(50)
  descripcion String?    @db.Text
  activo      Boolean    @default(true)
  empleados   empleados[]

  @@index([activo], map: "activo_idx")
}

model eventos {
  id          Int      @id @default(autoincrement())
  tenant_id   Int
  titulo      String   @db.VarChar(255)
  descripcion String?  @db.Text
  fecha_evento DateTime? @db.DateTime(0)
  imagen_url  String?  @db.VarChar(2048)
  created_at  DateTime @default(now()) @db.Timestamp(0)

 tenants tenants @relation(name: "TenantEvents", fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "eventos_ibfk_1")
  @@index([tenant_id])
}

model galeriafotos {
  id          Int      @id @default(autoincrement())
  tenant_id   Int
  titulo      String?  @db.VarChar(255)
  descripcion String?  @db.Text
  foto_url    String   @db.VarChar(2048)
  orden       Int?     @default(0)

  tenants tenants @relation(name: "TenantGallery", fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "galeriafotos_ibfk_1")

  @@index([tenant_id])
}

model mesas {
  id              Int          @id @default(autoincrement())
  tenant_id       Int
  nombre_o_numero String       @db.VarChar(50)
  capacidad       Int?         @default(0)
  estado          mesas_estado? @default(Libre)

  tenants  tenants    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "mesas_ibfk_1")
  ordenes  ordenes[]
  reservas reservas[]

  @@unique([tenant_id, nombre_o_numero])
}

model cierres_inventario {
  id                Int      @id @default(autoincrement())
  tenant_id         Int
  fecha_inicio      DateTime
  fecha_fin         DateTime
  tipo_cierre       String
  estado            String   @default("Borrador")
  total_diferencias Decimal  @default(0) @db.Decimal(10, 2)
  observaciones     String?  @db.Text
  realizado_por_id  Int
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt

  tenants   tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  empleados empleados @relation(fields: [realizado_por_id], references: [id])
  detalles  cierres_inventario_detalles[]

  @@index([tenant_id])
  @@index([fecha_inicio])
  @@index([estado])
  @@map("cierres_inventario")
}

model cierres_inventario_detalles {
  id                     Int      @id @default(autoincrement())
  cierre_id              Int
  producto_inventario_id Int
  stock_sistema          Decimal  @db.Decimal(10, 3)
  stock_fisico           Decimal  @db.Decimal(10, 3)
  diferencia             Decimal  @db.Decimal(10, 3)
  tipo_diferencia        String?
  valor_diferencia       Decimal  @default(0) @db.Decimal(10, 2)
  notas                  String?  @db.Text
  created_at             DateTime @default(now())

  cierres_inventario   cierres_inventario   @relation(fields: [cierre_id], references: [id], onDelete: Cascade)
  productos_inventario productos_inventario @relation(fields: [producto_inventario_id], references: [id])

  @@index([cierre_id])
  @@index([producto_inventario_id])
  @@map("cierres_inventario_detalles")
}

model kardex {
  id                     Int      @id @default(autoincrement())
  tenant_id              Int
  fecha                  DateTime @default(now()) @db.Timestamp(0)
  tipo_movimiento        String   @db.VarChar(20)
  motivo                 String   @db.VarChar(100)
  producto_inventario_id Int
  cantidad               Decimal  @db.Decimal(10, 3)
  costo_unitario         Decimal  @db.Decimal(10, 2)
  valor_total            Decimal  @db.Decimal(10, 2)
  saldo_cantidad         Decimal  @db.Decimal(10, 3)
  saldo_valor            Decimal  @db.Decimal(10, 2)
  documento_tipo         String?  @db.VarChar(50)
  documento_id           Int?
  usuario_id             Int?
  observaciones          String?  @db.Text
  created_at             DateTime @default(now()) @db.Timestamp(0)

  tenants              tenants              @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  productos_inventario productos_inventario @relation(fields: [producto_inventario_id], references: [id], onDelete: Restrict)
  empleados            empleados?           @relation(fields: [usuario_id], references: [id])

  @@index([tenant_id])
  @@index([producto_inventario_id])
}

model cajas {
  id                      Int          @id @default(autoincrement())
  tenant_id               Int
  fecha_apertura          DateTime     @default(now()) @db.Timestamp(0)
  fecha_cierre            DateTime?    @db.Timestamp(0)
  usuario_responsable_id  Int
  monto_inicial           Decimal      @db.Decimal(10, 2)
  monto_esperado          Decimal?     @default(0.00) @db.Decimal(10, 2)
  monto_real              Decimal?     @db.Decimal(10, 2)
  diferencia              Decimal?     @db.Decimal(10, 2)
  estado                  cajas_estado @default(Abierta)
  observaciones           String?      @db.Text
  created_at              DateTime     @default(now()) @db.Timestamp(0)

  tenants     tenants              @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  empleados   empleados            @relation(fields: [usuario_responsable_id], references: [id], onUpdate: Restrict)
  movimientos cajas_movimientos[]

  @@index([tenant_id])
  @@index([usuario_responsable_id])
  @@index([estado])
}

model cajas_movimientos {
  id             Int             @id @default(autoincrement())
  caja_id        Int
  tenant_id      Int
  tipo           cajas_tipo_mov
  concepto       String          @db.VarChar(255)
  monto          Decimal         @db.Decimal(10, 2)
  metodo_pago    pagos_metodo_pago
  documento_tipo String?         @db.VarChar(50)
  documento_id   Int?
  usuario_id     Int
  fecha_hora     DateTime        @default(now()) @db.Timestamp(0)
  notas          String?         @db.Text

  cajas      cajas      @relation(fields: [caja_id], references: [id], onDelete: Cascade)
  tenants    tenants    @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  empleados  empleados  @relation(fields: [usuario_id], references: [id], onUpdate: Restrict)

  @@index([caja_id])
  @@index([tenant_id])
  @@index([usuario_id])
  @@index([tipo])
}